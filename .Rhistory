# setwd("C:/Users/user/rlads_communicate/communicate.web.source")
library(readr)
library(dplyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(plotly)
library(dygraphs)
library(flexdashboard)
library(RColorBrewer)
library(scales)
library(xts)
# hue_pal()(4) # function to generate ggplot palette, 4 indicates 4 colors
h1n1_global <- read_csv("./unemployment.disease/data/h1n1_global_08_11.csv")
taiwan_tour_month <- read_csv("./unemployment.disease/data/taiwan_tour_byMonth.csv")
## function: tour to Asisan countries by month
tour_year_country <- function(date=c(98,97),country="Korea") {
tour_year_country <- taiwan_tour_month %>%
filter(T_Y==date[1]|T_Y==date[2]) %>%
filter(grepl(country,Country)) %>% # "中國|日本|韓國|香港|澳門"
# filter(grepl("China|Japan|Korea",Country))
rename("Count"=Cases)
}
h1n1_country <- function(country="Republic of Korea") {
h1n1_country <- h1n1_global %>%
filter(grepl(country,Country)) #Republic of Korea|China|Japan|Thailand|Indonesia|Singapore|Malaysia
# filter(grepl("Republic of Korea|China|Japan",Country))
# China|Japan|Republic of Korea|Hong Kong|Thailand|Indonesia|Singapore|Malaysia
}
#---Plotting---------
tour_2009_10_Korea <- tour_year_country(c(98,99),"Korea") %>% select(YMD, Count)
h1n1_Korea <- h1n1_country("Republic of Korea") %>% select(YMD, Cases)
Korea <- left_join(tour_2009_10_Korea,h1n1_Korea,by="YMD") %>% mutate(Count=Count/100)
Korea <- xts(Korea, order.by=(Korea$YMD))[,-1]
tour_2009_10_Japan <- tour_year_country(c(98,99),"Japan") %>% select(YMD, Count)
h1n1_Japan <- h1n1_country("Japan") %>% select(YMD, Cases)
Japan <- left_join(tour_2009_10_Japan,h1n1_Japan,by="YMD") %>% mutate(Count=Count/100)
Japan <- xts(Japan, order.by=(Japan$YMD))[,-1]
dygraph(Korea, main = "Korea", group = "H1N1") %>%
dyOptions(axisLabelFontSize = 12, axisLineWidth = 0.8, drawGrid=F) %>%
dySeries("Cases", axis = 'y2', label = "H1N1病例", color = hue_pal()(2)[1]) %>%
dySeries("Count", axis = 'y', label = "旅遊人數(百人)", color=hue_pal()(2)[2]) %>%
dyAxis("y", label = "旅遊人數(百)",axisLabelColor = hue_pal()(2)[2]) %>%
dyAxis("y2", label = "H1N1病例",axisLabelColor = hue_pal()(2)[1],independentTicks = TRUE) %>%
dyRangeSelector(height = 20, strokeColor = "") %>%
dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
dyLegend(labelsSeparateLines=T)
dygraph(Japan, main = "Japan", group = "H1N1") %>%
dyOptions(axisLabelFontSize = 12, axisLineWidth = 0.8, drawGrid=F) %>%
dySeries("Cases", axis = 'y2', label = "H1N1病例", color = hue_pal()(2)[1]) %>%
dySeries("Count", axis = 'y', label = "旅遊人數(百人)", color=hue_pal()(2)[2]) %>%
dyAxis("y", label = "旅遊人數(百)",axisLabelColor = hue_pal()(2)[2]) %>%
dyAxis("y2", label = "H1N1病例",axisLabelColor = hue_pal()(2)[1],independentTicks = TRUE) %>%
dyRangeSelector(height = 20, strokeColor = "") %>%
dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
dyLegend(labelsSeparateLines=T)
dygraph(Japan, main = "Japan", group = "H1N1")
dygraph(Korea, main = "Korea", group = "H1N1")
h1n1_global <- read_csv("./unemployment.disease/data/h1n1_global_08_11.csv")
setwd("C:/Users/user/rlads_communicate/communicate.web.source")
source('C:/Users/user/rlads_communicate/communicate.web.source/unemployment.disease/plot_h1n1.R', encoding = 'UTF-8')
dygraph(Japan, main = "Japan", group = "H1N1")
dygraph(Korea, main = "Korea", group = "H1N1")
dygraph(Japan, main = "Japan", group = "H1N1") %>%
dyOptions(axisLabelFontSize = 12, axisLineWidth = 0.8, drawGrid=F) %>%
dySeries("Cases", axis = 'y2', label = "H1N1病例", color = hue_pal()(2)[1]) %>%
dySeries("Count", axis = 'y', label = "旅遊人數(百人)", color=hue_pal()(2)[2]) %>%
dyAxis("y", label = "旅遊人數(百)",axisLabelColor = hue_pal()(2)[2]) %>%
dyAxis("y2", label = "H1N1病例",axisLabelColor = hue_pal()(2)[1],independentTicks = TRUE) %>%
dyRangeSelector(height = 20, strokeColor = "") %>%
dyHighlight(highlightSeriesOpts = list(strokeWidth = 3)) %>%
dyLegend(labelsSeparateLines=T)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)
library(grid)
options(scipen=999)
#----2015 MERS in Korea, count by month-----------
mers_Korea <- read_csv("./data/mers_Korea_cleaned.csv")
mers_month <- mers_Korea %>%
mutate(month_date=as.Date(paste0("2015-", mers_Korea$month,"-01"),"%Y-%m-%d")) %>%
group_by(month_date) %>%
summarise(month_case=sum(case), month_death=sum(death))
m <- c(1:4, 8,9,12)
zero <- rep(0, times = length(m))
df <- as.data.frame(cbind(m,zero,zero))
colnames(df) <- colnames(mers_month)
df <- df %>%
mutate(month_date=as.Date(paste0("2015-", df$month_date,"-01"),"%Y-%m-%d"))
mers_month <- full_join(df, mers_month) %>%
arrange(month_date)
#--------------------------------
#------data: Taiwan tour to foreign, count by month--------------
YMD <- function(x){paste(x,'-','01',sep="")}
rp <- function(x) {
library(stringr)
str_replace_all(x,"Mainland","China")}
taiwan_tour <- read_csv("./data/taiwan_tour_to_foreign_cleaned.csv") %>%
mutate(YMD=as.Date(YMD(Y_M)))
taiwan_tour <- taiwan_tour %>%
separate(Country,c("Ch_Country","Country")) %>%
mutate(Country=rp(Country))
#-------------------------------------------
tour_korea_2015 <- taiwan_tour %>%
filter(T_Y==104) %>%
filter(grepl("Japan|Korea",Country))
Sys.setlocale("LC_TIME", "C")  # set locale to display date in en
plot_tour <- ggplot(tour_korea_2015,mapping = aes(x=YMD, y=Cases, color=Country))+
geom_line() +
geom_point() +
scale_color_manual(values=c("#4621FF", "#FF0000")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "Number of travelers")
plot_mers <- ggplot(data=mers_month)+
geom_line(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_line(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
geom_point(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_point(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
scale_color_manual(values=c("#EE0000", "#FF9122")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "MERS in Korea")
# ggplotly(plot_mers)
#
# subplot(ggplotly(plot_tour), ggplotly(plot_mers), nrows = 2, shareX = TRUE)
grid.newpage()
grid.draw(rbind(ggplotGrob(plot_tour), ggplotGrob(plot_mers), size = "last"))
setwd("C:/Users/user/DS_project/liao")
debugSource('C:/Users/user/DS_project/liao/analysis_code/mers_tour.R')
debugSource('C:/Users/user/DS_project/liao/analysis_code/mers_tour.R')
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)
library(grid)
options(scipen=999)
#----2015 MERS in Korea, count by month-----------
mers_Korea <- read_csv("./data/mers_Korea_cleaned.csv")
mers_month <- mers_Korea %>%
mutate(month_date=as.Date(paste0("2015-", mers_Korea$month,"-01"),"%Y-%m-%d")) %>%
group_by(month_date) %>%
summarise(month_case=sum(case), month_death=sum(death))
m <- c(1:4, 8,9,12)
zero <- rep(0, times = length(m))
df <- as.data.frame(cbind(m,zero,zero))
colnames(df) <- colnames(mers_month)
df <- df %>%
mutate(month_date=as.Date(paste0("2015-", df$month_date,"-01"),"%Y-%m-%d"))
mers_month <- full_join(df, mers_month) %>%
arrange(month_date)
#--------------------------------
#------data: Taiwan tour to foreign, count by month--------------
YMD <- function(x){paste(x,'-','01',sep="")}
rp <- function(x) {
library(stringr)
str_replace_all(x,"Mainland","China")}
taiwan_tour <- read_csv("./data/taiwan_tour_to_foreign_cleaned.csv") %>%
mutate(YMD=as.Date(YMD(Y_M)))
taiwan_tour <- taiwan_tour %>%
separate(Country,c("Ch_Country","Country")) %>%
mutate(Country=rp(Country))
#-------------------------------------------
tour_korea_2015 <- taiwan_tour %>%
filter(T_Y==104) %>%
filter(grepl("Japan|Korea",Country))
Sys.setlocale("LC_TIME", "C")  # set locale to display date in en
plot_tour <- ggplot(tour_korea_2015,mapping = aes(x=YMD, y=Cases, color=Country))+
geom_line() +
geom_point() +
scale_color_manual(values=c("#4621FF", "#FF0000")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "Number of travelers")
plot_mers <- ggplot(data=mers_month)+
geom_line(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_line(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
geom_point(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_point(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
scale_color_manual(values=c("#EE0000", "#FF9122")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "MERS in Korea")
# ggplotly(plot_mers)
#
# subplot(ggplotly(plot_tour), ggplotly(plot_mers), nrows = 2, shareX = TRUE)
grid.newpage()
grid.draw(rbind(ggplotGrob(plot_tour), ggplotGrob(plot_mers), size = "last"))
tour_korea_2015 <- taiwan_tour %>%
filter(T_Y==104) %>%
filter(grepl("Japan|Korea",Country))
Sys.setlocale("LC_TIME", "C")  # set locale to display date in en
plot_tour <- ggplot(tour_korea_2015,mapping = aes(x=YMD, y=Cases, color=Country))+
geom_line() +
geom_point() +
scale_color_manual(values=c("#4621FF", "#FF0000")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "Number of travelers")
plot_mers <- ggplot(data=mers_month)+
geom_line(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_line(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
geom_point(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_point(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
scale_color_manual(values=c("#EE0000", "#FF9122")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "MERS in Korea")
grid.newpage()
grid.draw(rbind(ggplotGrob(plot_tour), ggplotGrob(plot_mers), size = "last"))
View(mers_Korea)
View(tour_korea_2015)
View(mers_month)
tour_korea_2015 <- taiwan_tour %>%
filter(T_Y==104) %>%
filter(grepl("Japan|Korea",Country)) %>%
select(YMD,Cases,Country)
rm(list=ls())
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)
library(grid)
options(scipen=999)
#----2015 MERS in Korea, count by month-----------
mers_Korea <- read_csv("./data/mers_Korea_cleaned.csv")
mers_month <- mers_Korea %>%
mutate(month_date=as.Date(paste0("2015-", mers_Korea$month,"-01"),"%Y-%m-%d")) %>%
group_by(month_date) %>%
summarise(month_case=sum(case), month_death=sum(death))
m <- c(1:4, 8,9,12)
zero <- rep(0, times = length(m))
df <- as.data.frame(cbind(m,zero,zero))
colnames(df) <- colnames(mers_month)
df <- df %>%
mutate(month_date=as.Date(paste0("2015-", df$month_date,"-01"),"%Y-%m-%d"))
mers_month <- full_join(df, mers_month) %>%
arrange(month_date)
#--------------------------------
#------data: Taiwan tour to foreign, count by month--------------
YMD <- function(x){paste(x,'-','01',sep="")}
rp <- function(x) {
library(stringr)
str_replace_all(x,"Mainland","China")}
taiwan_tour <- read_csv("./data/taiwan_tour_to_foreign_cleaned.csv") %>%
mutate(YMD=as.Date(YMD(Y_M)))
taiwan_tour <- taiwan_tour %>%
separate(Country,c("Ch_Country","Country")) %>%
mutate(Country=rp(Country))
tour_korea_2015 <- taiwan_tour %>%
filter(T_Y==104) %>%
filter(grepl("Japan|Korea",Country)) %>%
select(YMD,Cases,Country)
Sys.setlocale("LC_TIME", "C")  # set locale to display date in en
plot_tour <- ggplot(tour_korea_2015,mapping = aes(x=YMD, y=Cases, color=Country))+
geom_line() +
geom_point() +
scale_color_manual(values=c("#4621FF", "#FF0000")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "Number of travelers")
plot_mers <- ggplot(data=mers_month)+
geom_line(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_line(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
geom_point(mapping = aes(x=month_date,y=month_case, color="Cases")) +
geom_point(mapping = aes(x=month_date,y=month_death, color="Deaths")) +
scale_color_manual(values=c("#EE0000", "#FF9122")) +
scale_x_date(labels = function(x) format(x, "%h"), date_breaks="1 month") +
labs(x = "", y="", colour = "MERS in Korea")
# ggplotly(plot_mers)
#
# subplot(ggplotly(plot_tour), ggplotly(plot_mers), nrows = 2, shareX = TRUE)
grid.newpage()
grid.draw(rbind(ggplotGrob(plot_tour), ggplotGrob(plot_mers), size = "last"))
grid.newpage()
grid.draw(rbind(ggplotGrob(plot_tour), ggplotGrob(plot_mers), size = "last"))
write_csv(tour_korea_2015,path = "C:/Users/user/rlads_communicate/communicate.web.source/unemployment.disease/data/tour_korea_2015_month.csv")
write_csv(mers_month,path = "C:/Users/user/rlads_communicate/communicate.web.source/unemployment.disease/data/korea_mers_month.csv")
setwd("C:/Users/user/rlads_communicate/communicate.web.source")
tour_korea_2015 <- read_csv("./unemployment.disease/data/tour_korea_2015_month.csv")
mers_month <- read_csv("./unemployment.disease/data/korea_mers_month.csv")
rm(list = ls())
# setwd("C:/Users/user/rlads_communicate/communicate.web.source")
library(readr)
tour_korea_2015 <- read_csv("./unemployment.disease/data/tour_korea_2015_month.csv")
mers_month <- read_csv("./unemployment.disease/data/korea_mers_month.csv")
View(tour_korea_2015)
View(mers_month)
